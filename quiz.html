<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>DozenValues</title>
    <link rel=icon type=x-icon href="icon.png" />
    <link rel="shortcut icon" type=x-icon href="icon.png" />
    <meta property=og:title content="DozenValues" />
    <meta property=og:description
        content="DozenValues is a political test that aims to map differing political perspectives onto six axes." />
    <meta property=og:url content="https://quark88.github.io/dozenvalues" />
    <meta property=og:image content="https://github.com/QUARK88/dozenvalues/blob/master/icon.png?raw=true" />
    <meta property=og:type content="Political test" />
    <meta property=og:locale content="en_US" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>DozenValues</h1>
    <h2 id="questionNumber" style="text-align:center;"></h2>
    <p class="question" id="question"></p>
    <button class="button" style="background-color: #0080c0" onmouseover="this.style.backgroundColor='#0060a0'"
        onmouseout="this.style.backgroundColor='#0080c0'" onclick="answer(1)">Strongly Agree</button>
    <button class="button" style="background-color: #00c0ff;" onmouseover="this.style.backgroundColor='#00a0e0'"
        onmouseout="this.style.backgroundColor='#00c0ff'" onclick="answer(0.5)">Agree</button>
    <button class="button" style="background-color: #a0a0a0;" onmouseover="this.style.backgroundColor='#808080'"
        onmouseout="this.style.backgroundColor='#a0a0a0'" onclick="answer(0)">Neutral</button>
    <button class="button" style="background-color: #ff0000" onmouseover="this.style.backgroundColor='#e00000'"
        onmouseout="this.style.backgroundColor='#ff0000'" onclick="answer(-0.5)">Disagree</button>
    <button class="button" style="background-color: #c00000;" onmouseover="this.style.backgroundColor='#a00000'"
        onmouseout="this.style.backgroundColor='#c00000'" onclick="answer(-1)">Strongly Disagree</button>
    <button class="small_button" style="background-color: #808080;" onmouseover="this.style.backgroundColor='#606060'"
        onmouseout="this.style.backgroundColor='#808080'" onclick="prevQuestion()">Back</button><br>
</body>

<script>
    let questions;
    let max_score = { A1: 0, A2: 0, A3: 0, A4: 0, A5: 0, A6: 0 };
    let user_score = { A1: 0, A2: 0, A3: 0, A4: 0, A5: 0, A6: 0 };
    let qN = 0;
    let answers = [];
    function parseQuestions(data) {
        questions = data;
        const url = window.location.search
        if (url == "?r") {
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
        }
        for (const question of questions) {
            for (const [key, value] of Object.entries(question.effect)) {
                max_score[key] += Math.abs(value);
            }
        }
        loadQuestion();
    }
    function answer(effect) {
        for (const [key, value] of Object.entries(questions[qN].effect)) {
            user_score[key] += effect * value
        }
        qN++;
        answers.push(effect);
        if (qN < questions.length) {
            loadQuestion();
        } else {
            results();
        }
    }
    function calc(effect) {
        return (Math.round(((max_score[effect] + user_score[effect]) / (2 * max_score[effect])) * 1000) / 10).toFixed(1);
    }
    function results() {
        location.href = `results.html?${calc("A1")},${calc("A2")},${calc("A3")},${calc("A4")},${calc("A5")},${calc("A6")}`;
    }
    function loadQuestion() {
        document.getElementById("question").innerHTML = questions[qN].question;
        document.getElementById("questionNumber").innerHTML = "Question " + (qN + 1) + " of " + questions.length;
    }
    function prevQuestion() {
        if (qN == 0) {
            window.history.back();
        } else {
            qN--;
            loadQuestion();
            for (const [key, value] of Object.entries(questions[qN].effect)) {
                user_score[key] -= answers.at(-1) * value
            }
            answers.pop();
        }
    }
    fetch("./json/questions.json")
        .then(response => response.json())
        .then(data => parseQuestions(data));
</script>

</html>